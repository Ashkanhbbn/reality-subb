# Iran Ultimate Anti-Censorship System (v10) - GOD MODE
# Updated: 2025-06-28 | Tested on: Irancell, MCI, Rightel

meta:
  strategy: "hyper_stealth"
  threat_level: "extreme_iran"
  update_url: "https://raw.githubusercontent.com/yourusername/reality-subb/main/reality.yaml"

# ---------------------------
# Proxies (Multi-Protocol)
# ---------------------------
proxies:
  # Reality (Iran-Optimized)
  - name: "REALITY-IR-01"
    type: vless
    server: edge.snappfood.ir  # CDN داخلی برای استتار
    port: 443
    uuid: YOUR_UUID_HERE  # جایگزین با UUID واقعی
    flow: xtls-rprx-vision
    tls: true
    servername: www.digikala.com  # دامنه ایرانی معتبر
    reality-opts:
      public-key: YOUR_PUBLIC_KEY_HERE  # جایگزین با کلید واقعی
      short-id: "7d4a"  # کوتاه برای کاهش ردپا
      spider-x: "/static/img"  # مسیرهای رایج ایرانی
    client-fingerprint: edge  # اثرانگشت مرورگر رایج در ایران
    udp: true

  # Trojan (با استتار CDN داخلی)
  - name: "TROJAN-IR-01"
    type: trojan
    server: cdn.anetwork.ir  # CDN ایرانی
    port: 443
    password: "YOUR_STRONG_PASSWORD"
    sni: www.torob.com  # دامنه ایرانی
    alpn: ["http/1.1"]
    skip-cert-verify: false
    udp: true

  # VMess (WebSocket + TLS)
  - name: "VMESS-IR-WS"
    type: vmess
    server: dl.gamesly.ir  # CDN بازی ایرانی
    port: 443
    uuid: YOUR_UUID_HERE
    alterId: 0
    cipher: aes-128-gcm
    tls: true
    network: ws
    ws-opts:
      path: "/api/v1/stream"  # مسیر استتار شده
      headers:
        Host: dl.gamesly.ir

  # Shadowsocks (فوق‌سریع با استتار)
  - name: "SS-IR-OBFUS"
    type: ss
    server: download.ir  # دامنه ایرانی
    port: 443
    cipher: aes-256-gcm
    password: "YOUR_STRONG_PASSWORD"
    plugin: v2ray-plugin
    plugin-opts:
      mode: websocket
      host: "download.ir"
      tls: true
      path: "/download"

# ---------------------------
# DNS (Iran-Optimized)
# ---------------------------
dns:
  enable: true
  listen: 0.0.0.0:53
  enhanced-mode: redir-host
  use-hosts: true
  nameserver:
    - "https://shecan.ir/dns-query"  # DNS ایرانی ضد فیلتر
    - "https://dns.403.online/dns-query"  # DNS ضد فیلتر
    - "https://dns.google/dns-query#ipv4"
  fallback:
    - "tls://dns11.quad9.net:853#quad9"
    - "https://doh.opendns.com/dns-query"
  fallback-filter:
    geoip: true
    geoip-code: IR
    ipcidr:
      - 0.0.0.0/8
      - 10.0.0.0/8
      - 172.16.0.0/12
      - 127.0.0.0/8
    domain:
      - "+.ir"
      - "+.filter"

# ---------------------------
# Proxy Groups (Intelligent Routing)
# ---------------------------
proxy-groups:
  - name: "🚀 IR-AUTO"
    type: url-test
    url: "http://www.digikala.com/healthcheck"  # تست با دامنه ایرانی
    interval: 300
    tolerance: 100
    proxies:
      - REALITY-IR-01
      - TROJAN-IR-01
      - VMESS-IR-WS
      - SS-IR-OBFUS

  - name: "🔒 FAILSAFE-IR"
    type: fallback
    url: "http://cdn.snapp.ir/status"  # تست با CDN ایرانی
    interval: 120
    proxies:
      - "🚀 IR-AUTO"
      - DIRECT

# ---------------------------
# Rules (Advanced)
# ---------------------------
rules:
  # حذف ترافیک نظارتی
  - DOMAIN-KEYWORD,snitch,REJECT
  - DOMAIN-SUFFIX,ircert.ir,REJECT
  - DOMAIN-SUFFIX,filter,REJECT
  
  # سرویس‌های حیاتی ایرانی
  - DOMAIN-SUFFIX,snapp.ir,DIRECT
  - DOMAIN-SUFFIX,digikala.com,DIRECT
  - DOMAIN-SUFFIX,sheypoor.com,DIRECT
  
  # ترافیک داخلی
  - DOMAIN-SUFFIX,ir,DIRECT
  - GEOIP,IR,DIRECT
  - IP-CIDR,10.0.0.0/8,DIRECT
  - IP-CIDR,192.168.0.0/16,DIRECT
  
  # پلتفرم‌های اجتماعی
  - DOMAIN-SUFFIX,instagram.com,🚀 IR-AUTO
  - DOMAIN-SUFFIX,whatsapp.net,🚀 IR-AUTO
  - DOMAIN-SUFFIX,telegram.org,🚀 IR-AUTO
  
  # سرویس‌های جهانی
  - DOMAIN-SUFFIX,google.com,🚀 IR-AUTO
  - DOMAIN-SUFFIX,cloudflare.com,🚀 IR-AUTO
  - DOMAIN-SUFFIX,akamai.net,🚀 IR-AUTO
  
  # قانون نهایی
  - MATCH,🔒 FAILSAFE-IR

# ---------------------------
# Tun Settings (برای اندروید)
# ---------------------------
tun:
  enable: true
  stack: system
  dns-hijack: ["any:53"]
  mtu: 1400  # بهینه برای شبکه ایران
  auto-route: true
  auto-detect-interface: true

# ---------------------------
# Experimental Features
# ---------------------------
experimental:
  tcp-fast-open: true
  udp-fragment: true
  sniff-tls-sni: true
  proxy-protocol: 2

# ---------------------------
# Auto-Update System
# ---------------------------
auto-update:
  enable: true
  url: "https://raw.githubusercontent.com/yourusername/reality-subb/main/reality.yaml"
  interval: 43200  # هر 12 ساعت
  proxy: DIRECT
