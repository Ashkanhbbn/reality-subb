#
# 🛡️ GOD MODE PRO CONFIG (v12.1) - The Unbreakable Iranian Shield 🛡️
#
# Author: Gemini Pro-Analysis
# Philosophy: Chameleon Strategy, Dynamic Resilience, Performance Tuning, Layered Security
# Last Updated: 2025-06-28
#

meta:
  name: "🇮🇷 IRAN God Mode Pro"
  description: "پیکربندی فوق‌پیشرفته برای مقابله با فیلترینگ شدید در ایران. ترکیبی از استتار، سرعت و پایداری."
  author: "Gemini Pro"
  update-url: "https://raw.githubusercontent.com/yourusername/reality-subb/main/god-mode-pro.yaml" # لینک به‌روزرسانی خودکار

# LAYER 1: PROTOCOL ARMORY (Multi-Spectrum Evasion)
# استراتژی: استفاده از پروتکل‌های متنوع با استتار روی CDNهای داخلی برای حداکثر مقاومت
proxies:
  # 🥇 Primary: VLESS + Reality + Vision - بهترین گزینه برای پایداری و استتار
  - name: "🚀 REALITY-Prime"
    type: vless
    server: cdn.digikala.com       # سرور CDN داخلی معتبر با ترافیک بالا
    port: 443
    uuid: "YOUR_UUID_HERE"         # <--- UUID واقعی خود را اینجا وارد کنید
    network: tcp
    tls: true
    servername: www.digikala.com   # دامنه ایرانی معتبر برای SNI
    flow: xtls-rprx-vision
    reality-opts:
      public-key: "YOUR_PUBLIC_KEY_HERE" # <--- کلید عمومی واقعی خود را اینجا وارد کنید
      short-id: "7d4a"             # شناسه کوتاه برای کاهش ردپا
      spider-x: "/"                # مسیر رندوم برای فریب سیستم‌های تشخیص
    client-fingerprint: chrome     # اثر انگشت مرورگر رایج
    udp: true

  # 🥈 Secondary: Trojan - سریع و کارآمد با استتار روی CDN
  - name: "🚀 TROJAN-Stealth"
    type: trojan
    server: edge.snappfood.ir      # استفاده از CDN اسنپ‌فود
    port: 443
    password: "YOUR_STRONG_PASSWORD_HERE" # <--- پسورد قوی خود را اینجا وارد کنید
    sni: www.snapp.ir              # دامنه معتبر برای SNI
    alpn: ["h2", "http/1.1"]       # پشتیبانی از پروتکل‌های جدیدتر
    skip-cert-verify: false
    udp: true

  # 🥉 Tertiary: VMess + WebSocket + TLS - سازگاری بالا در شبکه‌های محدود
  - name: "🚀 VMESS-WS"
    type: vmess
    server: dl.gamesly.ir          # CDN بازی (ترافیک معمولاً کمتر بررسی می‌شود)
    port: 443
    uuid: "YOUR_UUID_HERE"         # <--- UUID واقعی خود را اینجا وارد کنید
    alterId: 0
    cipher: auto                   # انتخاب خودکار بهترین رمزنگاری
    tls: true
    network: ws
    ws-opts:
      path: "/v1/updates/check?version=2.5" # مسیر استتار شده شبیه به یک درخواست API
      headers:
        Host: dl.gamesly.ir
    udp: true

  # 🌪️ Specialty: Hysteria2 - بهترین عملکرد در شبکه‌های با Packet Loss شدید (مخصوصاً اینترنت ماهواره‌ای یا موبایل ضعیف)
  - name: "🚀 HY2-UDP-Storm"
    type: hysteria2
    server: app.tapsi.ir           # سرور اپلیکیشن ایرانی
    port: 443
    password: "YOUR_HYSTERIA_PASSWORD_HERE" # <--- پسورد هیستریا
    obfs: salamander               # ابفوسکیشن قدرتمند برای UDP
    obfs-password: "YOUR_OBFS_PASS_HERE" # <--- پسورد ابفوسکیشن
    sni: api.tapsi.ir              # استتار روی API تپسی
    udp: true

  # 🚨 FALLBACK: Emergency VMess - یک راه نجات ساده و سریع برای شرایط بحرانی
  - name: "🚨 EMERGENCY-VMESS"
    type: vmess
    server: "cdn.jabama.ir"
    port: 443
    uuid: "YOUR_EMERGENCY_UUID_HERE" # <--- UUID اضطراری
    alterId: 0
    cipher: "none"                 # برای حداکثر سرعت در شرایط اضطراری (ترافیک همچنان با TLS امن است)
    tls: true
    network: ws
    ws-opts:
      path: "/"
      headers:
        Host: "www.jabama.ir"
    client-fingerprint: "firefox"
    udp: true

# LAYER 2: INTELLIGENT DNS (Anti-Poisoning System)
# استراتژی: تفکیک هوشمند DNS برای دسترسی بدون اختلال به سرویس‌های داخلی و خارجی
dns:
  enable: true
  listen: 0.0.0.0:5353
  enhanced-mode: redir-host        # حالت بهینه برای TUN Mode
  fake-ip-range: 198.18.0.1/16
  use-hosts: true
  nameserver:
    - "https://dns.shecan.ir/dns-query"     # DNS ایرانی ضدتحریم (برای سایت‌های ایرانی)
    - "https://dns.403.online/dns-query"   # DNS ایرانی ضدتحریم جایگزین
    - "tls://1.1.1.1:853"                  # Cloudflare DNS over TLS
    - "https://dns.google/dns-query"       # Google DNS over HTTPS
  fallback:
    - "tls://dns.adguard-dns.com:853"      # AdGuard (مسدودسازی تبلیغات)
    - "tls://1.0.0.1:853"                  # Cloudflare Secondary
    - "https://doh.opendns.com/dns-query"
  fallback-filter:
    geoip: true
    geoip-code: IR
    ipcidr:
      - 2.16.0.0/15              # بازه IP متعلق به WhatsApp در اروپا
    domain:
      - "+.ir"                   # تمام دامنه‌های .ir از DNS اولیه استفاده کنند

# LAYER 3: DYNAMIC PROXY GROUPS (Smart Routing)
# استراتژی: انتخاب خودکار سریع‌ترین پروکسی و داشتن یک گروه پشتیبان برای مواقع قطعی کامل
proxy-groups:
  - name: "✅ PROXY"
    type: url-test
    url: "http://cp.cloudflare.com/generate_204" # URL استاندارد و سبک برای تست سرعت و پایداری
    interval: 300
    tolerance: 50
    proxies:
      - "🚀 REALITY-Prime"
      - "🚀 TROJAN-Stealth"
      - "🚀 VMESS-WS"
      - "🚀 HY2-UDP-Storm"
      - "🚨 EMERGENCY-VMESS"

  - name: "🔁 FAILOVER"
    type: fallback
    url: "http://www.bing.com"
    interval: 120
    proxies:
      - "✅ PROXY"
      - DIRECT # اگر هیچ پروکسی کار نکرد، به اینترنت مستقیم وصل شو (برای دسترسی به سایت‌های داخلی)

# LAYER 4: PRECISION RULES (Traffic Control)
# استراتژی: قوانین دقیق برای هدایت ترافیک، مسدودسازی جاسوس‌افزارها و بهینه‌سازی دسترسی
rules:
  # Block Trackers, Ads & Malware
  - DOMAIN-KEYWORD,ad,REJECT
  - DOMAIN-SUFFIX,googletagmanager.com,REJECT
  - DOMAIN-KEYWORD,snitch,REJECT
  - DOMAIN-SUFFIX,ircert.ir,REJECT
  - DOMAIN-SUFFIX,filter,REJECT

  # Direct Iranian Services
  - DOMAIN-SUFFIX,ir,DIRECT
  - DOMAIN-KEYWORD,snapp,DIRECT
  - DOMAIN-KEYWORD,digikala,DIRECT
  - GEOIP,IR,DIRECT

  # Proxy Specific Apps (Example for Desktop)
  - PROCESS-NAME,telegram.exe,✅ PROXY
  - PROCESS-NAME,nekoray.exe,DIRECT # خود برنامه نباید از پروکسی عبور کند

  # International Traffic via Proxy
  - DOMAIN-SUFFIX,googleapis.cn,✅ PROXY # ترافیک گوگل که از چین عبور می‌کند
  - DOMAIN-KEYWORD,telegram,✅ PROXY
  - DOMAIN-SUFFIX,whatsapp.net,✅ PROXY
  - GEOIP,CN,✅ PROXY

  # Final Rule
  - MATCH,✅ PROXY # نسخه بهینه شده: به جای Failover، مستقیما از گروه اصلی استفاده می‌کنیم. Failover در سطح خود گروه مدیریت می‌شود.

# LAYER 5: KERNEL-LEVEL OPTIMIZATION (TUN Interface)
tun:
  enable: true
  stack: system # پایدارتر از gvisor در اکثر پلتفرم‌ها
  dns-hijack: ["any:53"]
  mtu: 1420 # مقداری بهینه برای اکثر شبکه‌های موبایل ایران
  auto-route: true
  auto-detect-interface: true

# LAYER 6: ADVANCED ANTI-DPI TECHNIQUES
experimental:
  tcp-fast-open: true
  udp-fragment: true # برای شکستن بسته‌های UDP و دشوار کردن شناسایی
  sniff-tls-sni: true
