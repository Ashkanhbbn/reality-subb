# IRAN AUTOPILOT ULTIMATE v15
# Self-Configuring & Self-Healing System

# ===== سیستم تولید خودکار مقادیر =====
proxies:
  # Reality (مقادیر به صورت خودکار تولید می‌شوند)
  - name: "REALITY-AUTO"
    type: vless
    server: "{{ iran_cdn }}"
    port: 443
    uuid: "{{ uuid }}"
    flow: xtls-rprx-vision
    tls: true
    servername: "{{ iran_domain }}"
    reality-opts:
      public-key: "{{ public_key }}"
      short-id: "{{ short_id }}"
      spider-x: "{{ iran_path }}"
    client-fingerprint: "chrome"
    udp: true

  # سایر پروتکل‌ها (همان الگو)
  - name: "TUIC-AUTO"
    type: tuic
    server: "{{ iran_cdn }}"
    port: 443
    token: "{{ tuic_token }}"
    # ...

# ===== اسکریپت تولید خودکار مقادیر =====
autogen-script: |
  #!/bin/bash
  # تولید مقادیر پویا
  export uuid=$(cat /proc/sys/kernel/random/uuid)
  export public_key=$(openssl rand -base64 32 | tr -d '\n')
  export short_id=$(openssl rand -hex 4)
  export iran_cdn=$(shuf -n1 -e "edge.snappfood.ir" "cdn.snapp.ir" "dl.digikala.com")
  export iran_domain=$(shuf -n1 -e "www.digikala.com" "www.torob.com" "www.sheypoor.com")
  export iran_path=$(shuf -n1 -e "/static/img" "/images" "/assets")
  export tuic_token=$(openssl rand -hex 16)
  
  # جایگزینی در کانفیگ
  sed -i "s/{{ uuid }}/$uuid/g" /path/to/config.yaml
  sed -i "s/{{ public_key }}/$public_key/g" /path/to/config.yaml
  # ... (برای تمام متغیرها)

# ===== سیستم اجرای خودکار =====
autorun:
  enable: true
  interval: 3600  # هر 1 ساعت
  pre-commands:
    - "pkill -f nekobox"  # توقف سرویس قدیمی
  post-commands:
    - "am start -n moe.nb4l.neko/.ui.MainActivity"  # راه‌اندازی مجدد

# ===== سیستم همگام‌سازی کلیدها =====
key-sync:
  enable: true
  method: "ssh"  # یا telegram-bot
  server: "your.server.ip"
  port: 22
  username: "root"
  private-key: "/path/to/ssh_key"
  remote-path: "/etc/reality/server.key"
  sync-command: "cat {{ remote-path }} | base64 > /local/key.txt"

# ===== سیستم تشخیص و تعویض CDN =====
cdn-rotator:
  enable: true
  interval: 600  # هر 10 دقیقه
  pool:
    - "cdn1.snappfood.ir"
    - "edge2.snapp.ir"
    - "dl3.digikala.com"
    - "download4.iranapps.ir"
  health-check: "http://cdn-check.ir/status"
  threshold: 200ms  # زمان پاسخ قابل قبول

# ===== پیکربندی اصلی =====
proxy-groups:
  - name: "🚀 AUTO-PILOT"
    type: url-test
    url: "http://{{ iran_domain }}/health"
    interval: 120
    proxies:
      - "REALITY-AUTO"
      - "TUIC-AUTO"

dns:
  nameserver:
    - "https://dns.auto/query"  # DNS هوشمند

rules:
  - "MATCH,🚀 AUTO-PILOT"

# ===== سیستم گزارش‌گیری خودکار =====
telegram-reporter:
  enable: true
  bot-token: "YOUR_BOT_TOKEN"
  chat-id: "YOUR_CHAT_ID"
  report-interval: 86400  # هر 24 ساعت
  report-template: |
    📊 گزارش سیستم AUTOPILOT
    ⏱ زمان کارکرد: {{ uptime }}
    📡 CDN فعلی: {{ iran_cdn }}
    📶 کیفیت اتصال: {{ ping }}ms
    🔑 کلید فعلی: {{ public_key | truncate(8) }}
