# IRAN AUTOPILOT ULTIMATE v15
# Self-Configuring & Self-Healing System

# ===== Ø³ÛŒØ³ØªÙ… ØªÙˆÙ„ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ù…Ù‚Ø§Ø¯ÛŒØ± =====
proxies:
  # Reality (Ù…Ù‚Ø§Ø¯ÛŒØ± Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯)
  - name: "REALITY-AUTO"
    type: vless
    server: "{{ iran_cdn }}"
    port: 443
    uuid: "{{ uuid }}"
    flow: xtls-rprx-vision
    tls: true
    servername: "{{ iran_domain }}"
    reality-opts:
      public-key: "{{ public_key }}"
      short-id: "{{ short_id }}"
      spider-x: "{{ iran_path }}"
    client-fingerprint: "chrome"
    udp: true

  # Ø³Ø§ÛŒØ± Ù¾Ø±ÙˆØªÚ©Ù„â€ŒÙ‡Ø§ (Ù‡Ù…Ø§Ù† Ø§Ù„Ú¯Ùˆ)
  - name: "TUIC-AUTO"
    type: tuic
    server: "{{ iran_cdn }}"
    port: 443
    token: "{{ tuic_token }}"
    # ...

# ===== Ø§Ø³Ú©Ø±ÛŒÙ¾Øª ØªÙˆÙ„ÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ù…Ù‚Ø§Ø¯ÛŒØ± =====
autogen-script: |
  #!/bin/bash
  # ØªÙˆÙ„ÛŒØ¯ Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾ÙˆÛŒØ§
  export uuid=$(cat /proc/sys/kernel/random/uuid)
  export public_key=$(openssl rand -base64 32 | tr -d '\n')
  export short_id=$(openssl rand -hex 4)
  export iran_cdn=$(shuf -n1 -e "edge.snappfood.ir" "cdn.snapp.ir" "dl.digikala.com")
  export iran_domain=$(shuf -n1 -e "www.digikala.com" "www.torob.com" "www.sheypoor.com")
  export iran_path=$(shuf -n1 -e "/static/img" "/images" "/assets")
  export tuic_token=$(openssl rand -hex 16)
  
  # Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ø¯Ø± Ú©Ø§Ù†ÙÛŒÚ¯
  sed -i "s/{{ uuid }}/$uuid/g" /path/to/config.yaml
  sed -i "s/{{ public_key }}/$public_key/g" /path/to/config.yaml
  # ... (Ø¨Ø±Ø§ÛŒ ØªÙ…Ø§Ù… Ù…ØªØºÛŒØ±Ù‡Ø§)

# ===== Ø³ÛŒØ³ØªÙ… Ø§Ø¬Ø±Ø§ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± =====
autorun:
  enable: true
  interval: 3600  # Ù‡Ø± 1 Ø³Ø§Ø¹Øª
  pre-commands:
    - "pkill -f nekobox"  # ØªÙˆÙ‚Ù Ø³Ø±ÙˆÛŒØ³ Ù‚Ø¯ÛŒÙ…ÛŒ
  post-commands:
    - "am start -n moe.nb4l.neko/.ui.MainActivity"  # Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯

# ===== Ø³ÛŒØ³ØªÙ… Ù‡Ù…Ú¯Ø§Ù…â€ŒØ³Ø§Ø²ÛŒ Ú©Ù„ÛŒØ¯Ù‡Ø§ =====
key-sync:
  enable: true
  method: "ssh"  # ÛŒØ§ telegram-bot
  server: "your.server.ip"
  port: 22
  username: "root"
  private-key: "/path/to/ssh_key"
  remote-path: "/etc/reality/server.key"
  sync-command: "cat {{ remote-path }} | base64 > /local/key.txt"

# ===== Ø³ÛŒØ³ØªÙ… ØªØ´Ø®ÛŒØµ Ùˆ ØªØ¹ÙˆÛŒØ¶ CDN =====
cdn-rotator:
  enable: true
  interval: 600  # Ù‡Ø± 10 Ø¯Ù‚ÛŒÙ‚Ù‡
  pool:
    - "cdn1.snappfood.ir"
    - "edge2.snapp.ir"
    - "dl3.digikala.com"
    - "download4.iranapps.ir"
  health-check: "http://cdn-check.ir/status"
  threshold: 200ms  # Ø²Ù…Ø§Ù† Ù¾Ø§Ø³Ø® Ù‚Ø§Ø¨Ù„ Ù‚Ø¨ÙˆÙ„

# ===== Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ Ø§ØµÙ„ÛŒ =====
proxy-groups:
  - name: "ğŸš€ AUTO-PILOT"
    type: url-test
    url: "http://{{ iran_domain }}/health"
    interval: 120
    proxies:
      - "REALITY-AUTO"
      - "TUIC-AUTO"

dns:
  nameserver:
    - "https://dns.auto/query"  # DNS Ù‡ÙˆØ´Ù…Ù†Ø¯

rules:
  - "MATCH,ğŸš€ AUTO-PILOT"

# ===== Ø³ÛŒØ³ØªÙ… Ú¯Ø²Ø§Ø±Ø´â€ŒÚ¯ÛŒØ±ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± =====
telegram-reporter:
  enable: true
  bot-token: "YOUR_BOT_TOKEN"
  chat-id: "YOUR_CHAT_ID"
  report-interval: 86400  # Ù‡Ø± 24 Ø³Ø§Ø¹Øª
  report-template: |
    ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ø³ÛŒØ³ØªÙ… AUTOPILOT
    â± Ø²Ù…Ø§Ù† Ú©Ø§Ø±Ú©Ø±Ø¯: {{ uptime }}
    ğŸ“¡ CDN ÙØ¹Ù„ÛŒ: {{ iran_cdn }}
    ğŸ“¶ Ú©ÛŒÙÛŒØª Ø§ØªØµØ§Ù„: {{ ping }}ms
    ğŸ”‘ Ú©Ù„ÛŒØ¯ ÙØ¹Ù„ÛŒ: {{ public_key | truncate(8) }}
